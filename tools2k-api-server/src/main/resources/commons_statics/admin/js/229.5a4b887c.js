"use strict";(self["webpackChunklib_java_html"]=self["webpackChunklib_java_html"]||[]).push([[229],{99229:function(t,e,s){s.r(e),s.d(e,{default:function(){return d}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-upload"},[s("div",[s("div",{staticClass:"my-pannel pic-pannel"},[s("div",{staticClass:"my-header"},[t._v(" 附件列表 ")]),s("div",t._l(t.list,(function(e,i){return s("div",{key:i,staticClass:"attach_div",on:{click:function(s){return t.fileView(e)}}},[e.row.imageFile?[s("div",{staticClass:"imgDiv"},[s("img",{staticClass:"img-responsive center-block",attrs:{alt:e.row.memo,src:e.fullThumbPath}})]),s("p",[t._v(t._s(e.row.key)+"."+t._s(e.row.extName))]),s("p",[t._v(t._s(e.row.imageWidth)+" X "+t._s(e.row.imageHeight))])]:[s("div",{staticClass:"other-file"},[t._v(t._s(e.row.extName))]),s("p",[t._v("名字:"+t._s(e.row.key)+"."+t._s(e.row.extName))])]],2)})),0)]),s("div",{staticClass:"my-pannel edit-pannel"},[s("div",{staticClass:"p-header"},[t._v(" "+t._s(t.panelTitle)+" ")]),s("div",{staticClass:"p-body"},[s("el-form",{attrs:{labelPosition:"top"},nativeOn:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[s("h4",[t._v("Key: ")]),s("el-input",{attrs:{required:"",placeholder:"请输入key",readonly:t.editMode},model:{value:t.form.key,callback:function(e){t.$set(t.form,"key",e)},expression:"form.key"}}),t.editMode?s("div",{staticClass:"text-wrap"},[s("small",[t._v("文件绝对路径: ")]),s("small",[s("a",{staticClass:"text-wrap",attrs:{target:"_blank",href:t.fullPath}},[t._v(t._s(t.fullPath))])])]):s("div",[s("small",{staticClass:"text-muted"},[t._v("上传后，key就是文件名")])]),s("h4",[t._v("备注")]),s("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:t.form.memo,callback:function(e){t.$set(t.form,"memo",e)},expression:"form.memo"}}),s("hr"),s("h4",[t._v("请选择附件文件")]),s("input",{attrs:{type:"file"},on:{change:function(e){return t.fileSelectd(e.target.files)}}}),s("div",[t.editMode?s("small",{staticClass:"text-muted"},[t._v("如果选择了新的文件，原来的文件将会被替换")]):s("small",{staticClass:"text-muted"},[t._v("必须选择一个文件上传")])]),s("hr"),s("div",[s("el-button",{staticClass:"w100",attrs:{nativeType:"submit",type:"success"}},[t._v("保存 ")]),t.editMode?s("el-button",{staticClass:"w100",attrs:{type:"danger"},on:{click:t.fileDelete}},[t._v("删除 ")]):t._e(),t.editMode?s("el-button",{staticClass:"w100",attrs:{type:"warning"},on:{click:function(e){return t.switchToNewKey(!0)}}},[t._v("新建 ")]):t._e()],1)],1)],1)])])])},a=[],l=s(25787),o=s(98054),n={components:{},props:{},data(){return{list:[],panelTitle:"",editMode:!1,fullPath:"",form:{key:"",file:null,memo:""}}},computed:{},activated(){this.reload(),this.switchToNewKey(!0)},methods:{reload(){o.Z.ajax(l.Z.dictAttachments.list,{},(t=>{this.onListData(t)}))},onListData(t){this.list=t.list},fileView(t){this.switchToNewKey(!1),this.form.key=t.row.key,this.form.memo=t.row.memo,this.fullPath=t.fullPath},onSubmit(){this.editMode||null!==this.form.file||o.Z.showErrorMsg("请选择要上传的文件！");const t=new FormData;t.append("key",this.form.key),t.append("memo",this.form.memo),null!==this.form.file&&t.append("file",this.form.file),o.Z.ajax(l.Z.dictAttachments.save,t,(t=>{this.onListData(t),o.Z.showMsg("保存成功")}))},fileSelectd(t){const e=t.length;this.form.file=e>0?t[0]:null,console.debug("要上传文件发送了变化",this.form.file)},fileDelete(){if(!this.editMode)return;const t=this.form.key;o.Z.confirm(`确认删除<code>${t}</code>吗?`,(()=>{o.Z.ajax(l.Z.dictAttachments["delete"],{key:t},(t=>{this.onListData(t),this.switchToNewKey(!0),o.Z.showMsg("删除成功")}))}))},switchToNewKey(t){this.editMode=!t,t?(this.form.key="",this.form.memo="",this.panelTitle="新建Key"):this.panelTitle="编辑Key"}}},r=n,m=s(1001),c=(0,m.Z)(r,i,a,!1,null,null,null),d=c.exports}}]);
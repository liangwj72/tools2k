"use strict";(self["webpackChunklib_java_html"]=self["webpackChunklib_java_html"]||[]).push([[748],{73492:function(t,a,e){e.d(a,{Z:function(){return u}});var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"chart-panel"},[e("canvas",{ref:"chartCanvas",attrs:{height:"228px",width:"500px"}})])},o=[],i=e(55395),r=e.n(i),l=e(98054),d={name:"bar-chart",components:{},props:{color:{type:String,required:!1,default:"#0f7ee2"},title:{type:String,required:!0},labels:{type:Array,required:!0},xdata:{type:Array,required:!0}},data(){return{chart:null,gradient:null,chartData:{labels:this.labels,datasets:[{label:this.title,data:this.xdata,pointRadius:2.5,borderWidth:1,borderColor:this.color}]},chartOptions:{animation:!1,showScale:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:5},gridLines:{display:!1}}]},layout:{padding:0},scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}}},watch:{xdata(t){this.chartData.datasets[0].data=t,this.chart.update()}},mounted(){this.createChart()},methods:{createChart(){let t=this.$refs.chartCanvas,a=t.getContext("2d").createLinearGradient(0,0,0,500);a.addColorStop(0,l.Z.colorHexToRgba(this.color,.8)),a.addColorStop(1,l.Z.colorHexToRgba(this.color,.25)),this.chartData.datasets[0].backgroundColor=a,this.chart=new(r())(t,{type:"bar",data:this.chartData,options:this.chartOptions})},updateChart(t,a){this.chartData.datasets[0].data=a,this.chartData.labels=t,this.chart.update()}}},n=d,c=e(1001),h=(0,c.Z)(n,s,o,!1,null,null,null),u=h.exports},90604:function(t,a,e){e.d(a,{Z:function(){return u}});var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"chart-panel"},[e("canvas",{ref:"chartCanvas",attrs:{height:"150px"}}),t.showAvg?e("div",{staticClass:"down-txt"},[t._v("平均值: "+t._s(t.avg)+" "+t._s(t.avgPostFix)+"/ 秒")]):t._e()])},o=[],i=e(55395),r=e.n(i),l=e(91935),d={name:"line-chart",components:{},props:{chartData:{type:Object,required:!0},chartOptions:{type:Object,required:!0},showAvg:{type:Boolean,default:!1},avgPostFix:{type:String,default:""},scales:{type:Number,default:1}},data(){return{chart:null,avg:0}},mounted(){this.createChart()},methods:{createChart(){let t=this.$refs.chartCanvas;this.chart=new(r())(t,{type:"line",data:this.chartData,options:this.chartOptions})},updateChart(){if(this.chart.update(),this.showAvg){let t=this.chartData.datasets,a=0;t&&t.length>0&&t[0].data.forEach((t=>{a+=parseFloat(t)*this.scales}));let e=l.Z.timeDiff;this.avg=e&&e>0?(a/e).toFixed(2):0}}}},n=d,c=e(1001),h=(0,c.Z)(n,s,o,!1,null,null,null),u=h.exports},13748:function(t,a,e){e.r(a),e.d(a,{default:function(){return k}});var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"article-header"},[e("div",[t._v(" "+t._s(this.$route.meta.title)+" ")]),e("auto-refresh",{attrs:{fixed:!1},on:{refresh:t.reload}})],1),e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"flex-container"},[e("el-card",{staticClass:"hor-space10"},[e("el-progress",{attrs:{width:150,"stroke-width":20,type:"dashboard",percentage:t.diskInfo.percent}}),e("div",[t._v(" 硬盘空间: "),e("span",{staticClass:"text-caption"},[t._v(t._s(t.diskInfo.total))])])],1),e("br"),e("el-card",{staticClass:"full-body flex1"},[e("el-table",{attrs:{size:"mini",data:t.uriStat}},[e("el-table-column",{attrs:{label:"消耗时长"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.showUriStatDetail(a.row)}}},[t._v(" "+t._s(a.row.timeRangeMin)+" "),a.row.timeRangeMax>0?e("span",[t._v(" - "+t._s(a.row.timeRangeMax)+" ")]):t._e()])]}}])}),e("el-table-column",{attrs:{label:"次数"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(a.row.count)+" ")]}}])}),e("el-table-column",{attrs:{width:"200px",label:"占比"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("el-progress",{attrs:{"stroke-width":10,showText:!1,percentage:t.row.percent}})]}}])})],1)],1)],1)]),e("el-col",{attrs:{span:12}},[e("el-card",[e("bar-chart",{ref:"uriStatChart",attrs:{title:"Uri时长分布",labels:t.uriStatChart.labels,xdata:t.uriStatChart.data}})],1)],1)],1),e("br"),e("el-row",{staticClass:"mt-10",attrs:{gutter:10}},[e("el-col",{attrs:{span:12}},[e("line-chart",{ref:"actionChart",attrs:{chartData:t.actionChart.data,chartOptions:t.actionChart.options}})],1)],1),e("br"),e("comp-uri-detail")],1)},o=[],i=e(25787),r=e(98054),l=e(91935),d=e(90604),n=(e(42817),e(62222)),c=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("el-drawer",{attrs:{title:"详情: "+t.title,visible:t.visible,size:"50%"},on:{"update:visible":function(a){t.visible=a}}},[e("el-table",{attrs:{data:t.urlHistory}},[e("el-table-column",{attrs:{label:"url",prop:"url"}}),e("el-table-column",{attrs:{width:"180",label:"访问时间"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(t._f("timeFormat")(a.row.accessTime))+" ")]}}])}),e("el-table-column",{attrs:{width:"80",label:"消耗时间"},scopedSlots:t._u([{key:"default",fn:function(a){return[t._v(" "+t._s(a.row.cost)+" ms ")]}}])})],1)],1)],1)},h=[],u=e(17190),p={name:"comp-uri-detail",components:{},props:{},data(){return{visible:!1,uriStat:{},title:"",urlHistory:{}}},computed:{},mounted(){this.$eventBus.$off(n.Z.eventName.showUriStatDetail),this.$eventBus.$on(n.Z.eventName.showUriStatDetail,(({row:t})=>{console.debug("showUriStatDetail 事件: ",t),this.visible=!0,this.uriStat=t,this.reload()}))},methods:{reload(){this.uriStat.timeRangeMax>0?this.title=`${this.uriStat.timeRangeMin} - ${this.uriStat.timeRangeMax}`:this.title=`大于${this.uriStat.timeRangeMin}`;let t={id:this.uriStat.id};u.Z.ajax.post(i.Z.commonRuntime.getUrlStatById,t).then((t=>{console.debug("获取uristat访问详情",t),this.urlHistory=t.stat.urlHistory}))}}},b=p,C=e(1001),g=(0,C.Z)(b,c,h,!1,null,null,null),m=g.exports,f=e(73492),y={components:{BarChart:f.Z,CompUriDetail:m,LineChart:d.Z},props:{},data(){return{actionChart:{data:l.Z.actionChart.data,options:l.Z.actionChart.options},uriStatChart:{labels:[],data:[]},diskInfo:{total:"",used:"",free:"",percent:1},uriStat:[]}},computed:{},activated(){this.reload(!1)},deactivated(){console.debug("activated()")},methods:{reload(t){const a=this;r.Z.ajax(i.Z.commonRuntime.runtimeHistory,{},(function(e){a.onDataLoad(e.list),a.updateDiskInfo(e.diskInfo),a.updateUirStat(e.uriStat),t&&r.Z.showMsg("刷新成功")}))},updateUirStat(t){let a=0,e=[],s=[];t.forEach((t=>{a+=t.count,t.timeRangeMax>0?e.push(`${t.timeRangeMin}-${t.timeRangeMax}毫秒`):e.push(`大于${t.timeRangeMin}`),s.push(t.count)})),this.$refs.uriStatChart.updateChart(e,s),t.forEach((t=>{t.percent=a>0?r.Z.percent2num(100*t.count/a):0})),this.uriStat=t,console.debug("uri访问时长段统计:",this.uriStatChart)},updateDiskInfo(t){let a=t.totalSpace-t.usableSpace;t.totalSpace>0?this.diskInfo.percent=Number.parseFloat((100*a/t.totalSpace).toFixed(2)):this.diskInfo.percent=0,this.diskInfo.total=r.Z.toSizeStr(t.totalSpace),this.diskInfo.used=r.Z.toSizeStr(a),this.diskInfo.free=r.Z.toSizeStr(t.usableSpace)},onDataLoad(t){l.Z.onDataLoad(t),this.$refs.actionChart.updateChart()},showUriStatDetail(t){console.debug(`查看uri时长统计详情:id=${t.id}`),n.Z.showUriStatDetail(t)}}},S=y,w=(0,C.Z)(S,s,o,!1,null,null,null),k=w.exports},91935:function(t,a,e){e.d(a,{Z:function(){return g}});const s={memory:{total:"#5CB85C",used:"#5BC0DE"},cpu:{jvm:"#9418de"},thread:"#E6A23C",action:"#77e0c0",wsCount:{color0:"#e2cb15",color1:"#0f7ee2"},sendPacket:{count:"#574ed2",payload:"#2053ea"}};var o=s,i=e(98054),r={data:{labels:[],datasets:[{label:"已分配内存",fill:"1",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.memory.total,backgroundColor:i.Z.colorHexToRgba(o.memory.total,.4)},{label:"已经使用的内存",fill:"origin",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.memory.used,backgroundColor:i.Z.colorHexToRgba(o.memory.used,.5)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,callback:function(t){return t+" MB"}},gridLines:{display:!1}}]},layout:{padding:15},title:{display:!0,text:"内存"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},l={data:{labels:[],datasets:[{label:"JVM负载",fill:"origin",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.cpu.jvm,backgroundColor:i.Z.colorHexToRgba(o.cpu.jvm,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,callback:function(t){return t.toFixed(0)+"%"},suggestedMax:100,suggestedMin:0},gridLines:{display:!0}}]},layout:{padding:15},title:{display:!0,text:"CPU使用情况"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},d={data:{labels:[],datasets:[{label:"活动线程数",fill:"origin",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.thread,backgroundColor:i.Z.colorHexToRgba(o.thread,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:100},gridLines:{display:!1}}]},layout:{padding:15},title:{display:!0,text:"线程"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},n={data:{labels:[],datasets:[{label:"HTTP动态请求数",fill:"origin",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.action,backgroundColor:i.Z.colorHexToRgba(o.action,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:10},gridLines:{display:!1}}]},layout:{padding:5},title:{display:!0,text:"HTTP动态请求数"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},c={data:{labels:[],datasets:[{label:"接收请求数",fill:"false",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.wsCount.color0,backgroundColor:i.Z.colorHexToRgba(o.wsCount.color0,.4)},{label:"发送消息数",fill:"false",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.wsCount.color1,backgroundColor:i.Z.colorHexToRgba(o.wsCount.color1,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:10},gridLines:{display:!1}}]},layout:{padding:15},title:{display:!0,text:"Web socket API 接收/发送 次数"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},h={data:{labels:[],datasets:[{label:"接收请求流量",fill:"false",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.wsCount.color0,backgroundColor:i.Z.colorHexToRgba(o.wsCount.color0,.4)},{label:"发送消息流量",fill:"false",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.wsCount.color1,backgroundColor:i.Z.colorHexToRgba(o.wsCount.color1,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:10,callback:function(t){return t+" K"}},gridLines:{display:!1}}]},layout:{padding:5},title:{display:!0,text:"Web socket API 流量"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},u={data:{labels:["0-1毫秒","1-10毫秒","10-100毫秒","100-1000毫秒","1-10秒次数","10-100秒","100-1000秒","大于1000秒"],datasets:[{label:"sql执行时间",data:[0,0,0,2,0,0,0,0],pointRadius:2.5,borderWidth:1,borderColor:o.action,backgroundColor:i.Z.colorHexToRgba(o.action,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:100},gridLines:{display:!1}}]},layout:{padding:5},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},p={data:{labels:[],timeDiff:0,datasets:[{label:"10秒发包数量",fill:"origin",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.sendPacket.count,backgroundColor:i.Z.colorHexToRgba(o.sendPacket.count,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,suggestedMax:10},gridLines:{display:!1}}]},layout:{padding:5},title:{display:!0,text:"10秒发包数量"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},b={data:{labels:[],datasets:[{label:"10秒平均流量",fill:"origin",data:[],pointRadius:2.5,borderWidth:1,borderColor:o.sendPacket.payload,backgroundColor:i.Z.colorHexToRgba(o.sendPacket.payload,.4)}]},options:{animation:!1,scales:{yAxes:[{ticks:{beginAtZero:!0,callback:function(t){return t+" KB/s"}},gridLines:{display:!1}}]},layout:{padding:5},title:{display:!0,text:"10秒平均流量"},showLines:!0,scaleGridLineWidth:2,scaleShowGridLines:!1,scaleShowLabels:!1,datasetStrokeWidth:2,responsive:!0}},C=e(42817),g={sendPacketCountChart:p,sendPacketPayloadChart:b,avgSendPacketCount:0,avgSendPacketPayload:0,memoryChart:r,cpuChart:l,threadChart:d,actionChart:n,wsCountChart:c,wsPayloadChart:h,sqlTimeChart:u,timeDiff:0,onDataLoad(t){const a=[],e=[],s=[],o=[],r=[],l=[],d=[],n=[],c=[],h=[],u=[],p=[];let b=0,g=0;for(let C of t){let t=C.recordTime;(0===b||b>t)&&(b=t),g<t&&(g=t),this.timeDiff=g-b>0?(g-b)/1e3+10:0,a.push(i.Z.timeFormat(t,"hh:mm:ss")),e.push(i.Z.toMemoryM(C.memory.totalMemory)),s.push(i.Z.toMemoryM(C.memory.usedMemory)),o.push(Math.round(100*C.processCpuLoad)/100),r.push(C.threadCount),l.push(C.actionCount),d.push(C.wsUpCount),n.push(C.wsUpCount),c.push(i.Z.sizeToK(C.wsUpPayload)),h.push(i.Z.sizeToK(C.wsDownPayload)),u.push(C.sendPacketCount),p.push(i.Z.sizeToK(C.sendPacketPayload/10))}this.updateMemoryChart(a,e,s),this.updateCpuChart(a,o),this.updateThreadChart(a,r),this.updateActionChart(a,l),C.Z.serverInfo.hasWsApiImpl&&(this.updateWsCountChart(a,d,n),this.updateWsPayloadChart(a,c,h)),C.Z.serverInfo.hasSendPacketData&&(this.updateSendPacketCountChart(a,u),this.updateSendPacketPayloadChart(a,p))},updateWsCountChart(t,a,e){const s=this.wsCountChart.data;s.datasets[0].data=a,s.datasets[1].data=e,s.labels=t},updateWsPayloadChart(t,a,e){const s=this.wsPayloadChart.data;s.datasets[0].data=a,s.datasets[1].data=e,s.labels=t},updateActionChart(t,a){const e=this.actionChart.data;e.datasets[0].data=a,e.labels=t},updateSendPacketCountChart(t,a){const e=this.sendPacketCountChart.data;e.datasets[0].data=a,e.labels=t},updateSendPacketPayloadChart(t,a){const e=this.sendPacketPayloadChart.data;e.datasets[0].data=a,e.labels=t},updateThreadChart(t,a){const e=this.threadChart.data;e.datasets[0].data=a,e.labels=t},updateCpuChart(t,a){const e=this.cpuChart.data;e.datasets[0].data=a,e.labels=t},updateMemoryChart(t,a,e){const s=this.memoryChart.data;s.datasets[0].data=a,s.datasets[1].data=e,s.labels=t}}}}]);